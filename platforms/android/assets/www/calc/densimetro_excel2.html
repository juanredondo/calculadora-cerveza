<html>
   <head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
   <title>Prueba tabla densimetro</title>
   <script type="text/javascript" src="script/jquery-1.8.3.min.js"></script>
   <script language="javascript">
   
      var i = 1;
   
      $(document).ready(function() {               
         $(".botonExcel").click(function(event) {
            createDynamicTable($('#Exportar_a_Excel'), 1050, 1070, 2, 60, 80, 2, 20);
            $("#datos_a_enviar").val( $("<div>").append( $("#Exportar_a_Excel").eq(0).clone()).html());
            $("#FormularioExportacion").submit();
         });
      });
      
      function createDynamicTable(tbody, hydrometerMin, hydrometerMax, hydrometerInc, tempMin, tempMax, tempInc, tempCorrection) {
         if (tbody == null || tbody.length < 1) return;

         hydrometerMin = parseHydrometer(hydrometerMin);
         hydrometerMax = parseHydrometer(hydrometerMax);
         hydrometerInc = parseHydrometer(hydrometerInc);

         //Cabecera con valores de densidad
         var trow = $("<tr>");
         addColumn(trow, "Temp./Dens.");
         for (var h = hydrometerMin; h <= hydrometerMax ; h += hydrometerInc) {           
            addColumn(trow, round(h, 3));
         }
         trow.appendTo(tbody);
         
         for (var t = tempMin; t <= tempMax; t += tempInc) {
            var trow = $("<tr>");
            addColumn(trow, t);
            for (var h = hydrometerMin; h <= hydrometerMax; h += hydrometerInc) {
               addColumn(trow, hydrometerCorrection(h, t, tempCorrection));   
            }
            trow.appendTo(tbody);
         }
         
      } 
      
      function addColumn(trow, value) {
         $("<td>")
            .text(value)
            .appendTo(trow);
      }
      
      function hydrometerCorrection(hydrometer, temp, correctionTemp) {
         return round(hydrometer + ((calculateTempCorrection(correctionTemp) / calculateTempCorrection(temp)) - 1), 3);
      }
      
      function parseHydrometer(hydrometer) {
         hydrometer = parseFloatEx(hydrometer);
         if (hydrometer.toString().indexOf(".") == -1) return hydrometer / 1000;
         return hydrometer;
      }
      
		function calculateTempCorrection(temp) {   
		   return 1 - (temp + 288.9414) / (508929.2 * (temp + 68.12963)) * Math.pow(temp - 3.9863, 2);
		}      
      
      function round(number, off) {
		   i=Math.pow(10,off)
		   return (Math.round(number*i)/i).toFixed(off).replace(".", "");
		}
      
      function parseFloatEx(value)
		{
			return parseFloat(value.toString().replace(",","."));
		}
      
   </script>

   <style type="text/css">
      .botonExcel{cursor:pointer;}
      
      td.tableCell {
         mso-number-format:"\@";
      }
   </style>
   </head>
   <body>
      <table width="50%" border="1" cellpadding="10" cellspacing="0" bordercolor="#666666" id="Exportar_a_Excel" style="border-collapse:collapse; display:none;">   
      </table>
      
      <form action="exportar_excel.php" method="post" target="_blank" id="FormularioExportacion">
         <p>Exportar a Excel  <img src="img/export_to_excel.gif" class="botonExcel" /></p>
         <input type="hidden" id="datos_a_enviar" name="datos_a_enviar" />
      </form>
   </body>
</html>
